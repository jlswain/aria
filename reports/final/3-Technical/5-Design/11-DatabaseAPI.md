## Database Interface
---

### General

This interface provides a way for components in our system to query the database using the defined
methods. Any component which has an instance of the Retriever class has access to these methods. 
A combination of prepared statements and having the database only accessed through an instance of
Retriever eliminates the possibility of SQL injection, protecting our system.

#### Required Interfaces

- There are no other interfaces required

#### Setup Instructions

To test this interface, there must be an existing database populated with event records. 
Accomplishing this through our system is a fairly comprehensive task. A database can be created by
passing the desired name to the Database class. The created database will initially be empty. To
populate it, devices must be created and registered to the hub. Events then need to be generated 
from these devices, sent through the system, and logged in the database. At this point, this 
interface is ready to be tested.

An alternative to this is to create and populate a test database manually. An instance of Retriever 
could be contained by a stubbed component and this interface could then be tested.

### Interface Documentation

<table border>
<tr>
<th valign="top">
    Title
</th>
<td>
    <b>Get Recent Events Across All Devices in a Window </b> <br>
    <i>
        Allows the retrival of a list of events starting from a specified index, ignoring events
        from specific devices if desired.
    </i>
</td>
</tr>

<tr>
<th valign="top">
    Data Params
</th>
<td>
    <b> start {</b>
    <p class = "tab">
        <i>
            Type: Integer <br> <br>
            Description: Index in the database to start retrieving from, with 1 being the most
                        recent record 
        </i>
    </p>
    <b> } </b> <br>
    <b> count {</b>
    <p class = "tab">
        <i>
            Type: Integer <br> <br>
            Description: Number of events to retrieve
        </i>
    </p>
    <b> } </b> <br>
    <b> ignore {</b>
    <p class = "tab">
        <i>
            Type: String <br> <br>
            Description: A list of device UUID's as strings, seperated by commas. Any events 
            generated by a device with a UUID in this list will be ignored.
        </i>
    </p>
    <b> } </b> <br>

</td>
</tr>

<tr>
    <th valign="top">
    Response
    </th>
    <td>
        The response is a list of dictionaries, where each dictionary represents an event retrieved.
        If no events are retrieved, an empty list is returned. <br>
        <b>Example:</b> <br>
        <code> [ <br> 
        { id : 2, timestamp : 2016-11-26 22:59:52, request_id : 3, source : 
        123e4567-e89b-12d3-a456-426655440000, attribute : brightness, value : 3 }<br>
        { id : 1, timestamp : 2016-11-26 23:00:02, request_id : 4, source : 
        3456e476-e89b-12d3-a456-426655440000, attribute : hue, value : 1 }<br>
        { id : 3, timestamp : 2016-11-26 22:59:52, request_id : 5, source : 
        123e1937-e89b-12d3-a456-426655440000, attribute : temperature, value : 20 }<br>
        ]</code><br>       
    </td>
</tr>

<tr>
    <th valign="top">
    Sample Call
    </th>
    <td>
        <pre>
            getEventWindow(5, 10, "")
        </pre>
    </td>
</tr>

<tr>
    <th valign="top">
    Notes
    </th>
    <td>
    </td>
</tr>
</table> <br>

<table border>
<tr>
<th valign="top">
    Title
</th>
<td>
    <b>Get Recent Events for One Device in a Window </b> <br>
    <i>
        Allows the retrival of a list of events starting from a specified index for a specific 
        device, ignoring events from specific devices if desired.
    </i>
</td>
</tr>

<tr>
<th valign="top">
    Data Params
</th>
<td>
    <b> id {</b>
    <p class = "tab">
        <i>
            Type: String <br> <br>
            Description: UUID of device to get events from
        </i>
    </p>
    <b> } </b> <br>
    <b> start {</b>
    <p class = "tab">
        <i>
            Type: Integer <br> <br>
            Description: Index in the database to start retrieving from, with 1 being the most
                        recent record 
        </i>
    </p>
    <b> } </b> <br>
    <b> count {</b>
    <p class = "tab">
        <i>
            Type: Integer <br> <br>
            Description: Number of events to retrieve
        </i>
    </p>
    <b> } </b> <br>

</td>
</tr>

<tr>
    <th valign="top">
    Response
    </th>
    <td>
        The response is a list of dictionaries, where each dictionary represents an event retrieved.
        If no events are retrieved, an empty list is returned. <br>
        <b>Example:</b> <br>
        <code> [ <br> 
        { id : 2, timestamp : 2016-11-26 22:59:52, request_id : 3, source : 
        123e4567-e89b-12d3-a456-426655440000, attribute : brightness, value : 3 }<br>
        { id : 1, timestamp : 2016-11-26 23:00:02, request_id : 4, source : 
        123e4567-e89b-12d3-a456-426655440000, attribute : hue, value : 1 }<br>
        { id : 3, timestamp : 2016-11-26 22:59:52, request_id : 5, source : 
        123e4567-e89b-12d3-a456-426655440000, attribute : temperature, value : 20 }<br>
        ]</code><br>       
    </td>
</tr>

<tr>
    <th valign="top">
    Sample Call
    </th>
    <td>
        <pre>
            getEventWindow("123e4567-e89b-12d3-a456-426655440000", 10, 5)
        </pre>
    </td>
</tr>

<tr>
    <th valign="top">
    Notes
    </th>
    <td>
    </td>
</tr>
</table>

<style type="text/css">
<!--
.tab { margin-left: 40px; }
-->
</style>
